<!DOCTYPE html>
<html>
<head>
    <title><%= @page_title or "OpenAshDieBack - GeeFu" %></title>
    <%= stylesheet_link_tag "application", :media => "all" %>
    <%= javascript_include_tag "application" %>
    <%= csrf_meta_tags %>
    
    <%unless params[:badge].nil?%>
        <script>console.log("loading cheves");</script>
        <script src="/Credit/src/frontend/cheeves.js"></script>
        <link href="/Credit/src/frontend/cheeves.css" media="all" rel="stylesheet" type="text/css" />
    <%end%>
</head>
<body>

<div id="page" class="container">
    <%= bootstrap_flash %>
    <%= render partial: "layouts/navbar" %>
    <div class="well">
        <%= yield %>
    </div>
</div>

<script>

    <%unless params[:badge].nil?%>
        <% if user_signed_in? %>
            console.log("running cheves");

            <% url = params[:url] %>
            <% email = params[:email] %>
            <% badgep = params[:badge] %>

            card = <%= Badge.getCard(url, email, badgep) %>
            badge = <%= Badge.getBadge(url, badgep) %>
            cheeves.manualUpdate(card, badge);
        <% end %>
    <% end %>

    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-45021109-1', 'nbi.ac.uk');
    ga('send', 'pageview');


</script>
</body>
</html>
