<script language="javascript" src="/dalliance/js/bam.js"></script>
<script language="javascript" src="/dalliance/js/bigwig.js"></script>
<script language="javascript" src="/dalliance/js/das.js"></script>
<script language="javascript" src="/dalliance/js/spans.js"></script>
<script language="javascript" src="/dalliance/js/utils.js"></script>
<script language="javascript" src="/dalliance/js/cbrowser.js"></script>
<script language="javascript" src="/dalliance/js/feature-popup.js"></script>
<script language="javascript" src="/dalliance/js/tier.js"></script>
<script language="javascript" src="/dalliance/js/features.js"></script>
<script language="javascript" src="/dalliance/js/color.js"></script>
<script language="javascript" src="/dalliance/js/feature-draw.js"></script>
<script language="javascript" src="/dalliance/js/sequence-draw.js"></script>
<script language="javascript" src="/dalliance/js/domui.js"></script>
<script language="javascript" src="/dalliance/js/karyoscape.js"></script>
<script language="javascript" src="/dalliance/js/quant-config.js"></script>
<script language="javascript" src="/dalliance/js/track-adder.js"></script>
<script language="javascript" src="/dalliance/js/chainset.js"></script>
<script language="javascript" src="/dalliance/js/version.js"></script>
<script language="javascript" src="/dalliance/js/sha1.js"></script>
<script language="javascript" src="/dalliance/js/sample.js"></script>
<script language="javascript" src="/dalliance/js/kspace.js"></script>
<script language="javascript" src="/dalliance/json/json2.js"></script>
<script language="javascript" src="/dalliance/js/bin.js"></script>
<script language="javascript" src="/dalliance/js/twoBit.js"></script>
<script language="javascript" src="/dalliance/js/thub.js"></script>
<script language="javascript" src="/dalliance/js/svg-export.js"></script>
<script language="javascript" src="/dalliance/jszlib/js/inflate.js"></script>
<script language="javascript" src="/dalliance/js/browser-ui.js"></script>
<script language="javascript" src="/dalliance/js/glyphs.js"></script>
<script language="javascript" src="/dalliance/js/session.js"></script>
<script language="javascript" src="/dalliance/js/jbjson.js"></script>
<script language="javascript" src="/dalliance/js/sourceadapters.js"></script>
<script language="javascript" src="/dalliance/polyfills/html5slider.js"></script>
<script language="javascript" src="/dalliance/js/ensembljson.js"></script>
<script language="javascript" src="/dalliance/js/overlay.js"></script>

<script language="javascript">
  var b = new Browser({
    chr:          '22',
    viewStart:    30000000,
    viewEnd:      30030000,
    cookieKey:    'human2',

    chains: {
      hg19ToHg18: new Chainset('http://www.derkholm.net:8080/das/hg19ToHg18/', 'GRCh37', 'NCBI36',
                               {
                                  speciesName: 'Human',
                                  taxon: 9606,
                                  auth: 'GRCh',
                                  version: 37
                               })
    },

    sources:     [{name:                 'Genome',      
                   twoBitURI:            'http://www.biodalliance.org/datasets/hg18.2bit',
                   // uri:                  'http://www.derkholm.net:8080/das/hsa_54_36p/',      
                   tier_type:            'sequence'},
                  {name:                 'e! transcripts',
                   uri:                  'http://beta.rest.ensembl.org',
                   tier_type:            'ensembl',
                   species:              'human',
                   type:                 ['transcript', 'exon', 'cds'],
                   mapping: 'hg19ToHg18',
                  },
                  {name:                 'Genes',     
                   desc:                 'Gene structures from Ensembl 54',
                   uri:                  'http://www.derkholm.net:8080/das/hsa_54_36p/',      
                   collapseSuperGroups:  true,
                   provides_karyotype:   true,
                   provides_search:      true,
                   provides_entrypoints: true,
                   maxbins:              false,
                   featureInfoPlugin: function(f, info) {
                      info.add('Testing', 'This is another test!');
                   }
                  }, 
                  {name:                 'Repeats',     
                   uri:                  'http://www.derkholm.net:8080/das/hsa_54_36p/',      
                   stylesheet_uri:       'http://www.biodalliance.org/stylesheets/repeats-L1.xml'}, 
                  {name:                 'CpG Density', 
                   uri:                  'http://www.derkholm.net:8080/das/hg18comp/',        
                   // stylesheet_uri:       'http://www.biodalliance.org/stylesheets/cpg-hist.xml',
                   quantLeapThreshold: 0.8,
                   forceReduction: -1,
                   style:                [{type: 'cpgoe',
                                           style: {glyph: 'LINEPLOT',
                                                   FGCOLOR: 'green', HEIGHT: '50', MIN: 0, MAX: 1.2}}]},
                    {name: 'MeDIP-raw',
                     desc: 'MeDIP-seq reads from Nature Biotech. 26:779-785',
                     uri: 'http://www.derkholm.net:8080/das/medipseq_reads/'},
                  {name:                 'BWG test',
                   bwgURI:               'http://www.biodalliance.org/datasets/spermMethylation.bw',
                   stylesheet_uri:       'http://www.ebi.ac.uk/das-srv/genomicdas/das/batman_seq_SP/stylesheet',
                   quantLeapThreshold: 80},
                  {name:                 'BBD test',
                   bwgURI:               'http://www.biodalliance.org/datasets/ensGene.bb',
                   link:                 'http://ncbi36.ensembl.org/Homo_sapiens/Gene/Summary?t=$$',
                   collapseSuperGroups:  true,
                   disable: true}
                  ,{name:                 'Style test',
                   uri:                  'http://v0311.nbi.ac.uk/features/dalliance/1.xml',
                   features_uri:         'http://v0311.nbi.ac.uk/features/dalliance/1.xml',
                   stylesheet_uri:       'http://v0311.nbi.ac.uk/features'}
                 ,{name:                 'BWG hist',
                   bwgURI:               'http://www.biodalliance.org/datasets/spermMethylation.bw',
                   style:     [{type: 'default',
                                style:  {glyph: 'HISTOGRAM', HEIGHT: 50, MIN: 0, MAX: 100}}],
                   quantLeapThreshold: 80}
                ],

    setDocumentTitle: true,
    uiPrefix: '',

    searchEndpoint: new DASSource('http://www.derkholm.net:8080/das/hsa_54_36p/'),
    browserLinks: {
        Ensembl: 'http://ncbi36.ensembl.org/Homo_sapiens/Location/View?r=${chr}:${start}-${end}',
        UCSC: 'http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg18&position=chr${chr}:${start}-${end}',
        Sequence: 'http://www.derkholm.net:8080/das/hg18comp/sequence?segment=${chr}:${start},${end}'
    }
  });

  b.addFeatureInfoPlugin(function(f, info) {
      info.add('Testing', 'This is a test!');
    });
</script>

<%- model_class = Experiment -%>
<div class="page-header">
  <h1>Experiment ID <%= @experiment.id%></h1>
</div>

<div id='svgHolder'>Dalliance genome browser goes here.  Unless you have an ancient web browser or something.</div>

<dl class="dl-horizontal">
  <dt><strong><%= model_class.human_attribute_name(:name) %>:</strong></dt>
  <dd><%= @experiment.name %></dd>
  <dt><strong><%= model_class.human_attribute_name(:description) %>:</strong></dt>
  <dd><%= @experiment.description %></dd>
  <dt><strong><%= model_class.human_attribute_name(:uses_bam_file) %>:</strong></dt>
  <dd><%= @experiment.uses_bam_file %></dd>
  <% if @experiment.uses_bam_file %>
    <dt><strong><%= model_class.human_attribute_name(:bam_file_path) %>:</strong></dt>
    <dd><%= @experiment.bam_file_path %></dd>
  <% end %>
  <dt><strong>Number of features:</strong></dt>
  <dd><%= @experiment.features.count %></dd>
  <dt><strong><%= model_class.human_attribute_name(:meta) %>:</strong></dt>
  <dd><%= @experiment.html_meta %></dd>
</dl>

<div class="form-actions">
  <%= link_to t('.back', :default => t("helpers.links.back")),
              experiments_path, :class => 'btn'  %>
  <%#= link_to t('.edit', :default => t("helpers.links.edit")),
              edit_experiment_path(@experiment), :class => 'btn' %>
  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              experiment_path(@experiment),
              :method => 'delete',
              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              :class => 'btn btn-danger' %>
</div>
